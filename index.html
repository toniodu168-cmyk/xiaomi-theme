<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cr√©ateur de Th√®mes Xiaomi HyperOS 3</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Open+Sans:wght@400;700&family=Lato:wght@400;700&family=Montserrat:wght@400;700&family=Playfair+Display:wght@400;700&family=Poppins:wght@400;700&family=Dancing+Script:wght@400;700&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #FF6B00 0%, #FF8E53 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 14px; }
        .content { padding: 30px; }
        .section { margin-bottom: 30px; }
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: #FF6B00;
            border-radius: 2px;
        }
        .input-group { margin-bottom: 20px; }
        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #555;
            margin-bottom: 8px;
        }
        input[type="text"], select, input[type="range"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: #FF6B00;
        }
        select {
            cursor: pointer;
            background-color: white;
        }
        input[type="range"] {
            padding: 0;
            height: 40px;
            cursor: pointer;
        }
        .color-grid, .font-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .color-picker-group, .font-picker-group, .icon-shape-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            transition: all 0.3s;
        }
        .color-picker-group:hover, .font-picker-group:hover, .icon-shape-group:hover {
            background: #f0f1f3;
            transform: translateY(-2px);
        }
        .color-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        input[type="color"] {
            width: 60px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        .color-code {
            flex: 1;
            padding: 10px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            text-align: center;
            font-weight: bold;
        }
        .font-preview {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            text-align: center;
        }
        .font-preview-text {
            font-size: 18px;
            margin-bottom: 5px;
        }
        .font-preview-small {
            font-size: 12px;
            color: #666;
        }
        .icon-shapes {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        .icon-shape-option {
            aspect-ratio: 1;
            background: white;
            border: 3px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        .icon-shape-option:hover {
            border-color: #FF6B00;
            transform: scale(1.05);
        }
        .icon-shape-option.active {
            border-color: #FF6B00;
            background: #fff8f3;
            box-shadow: 0 4px 12px rgba(255, 107, 0, 0.3);
        }
        .shape-square { border-radius: 0%; }
        .shape-rounded { border-radius: 20%; }
        .shape-superround { border-radius: 35%; }
        .shape-circle { border-radius: 50%; }
        .shape-squircle { border-radius: 25%; }
        .shape-teardrop { border-radius: 25% 25% 25% 60%; }
        .shape-pebble { border-radius: 35% 65% 70% 30% / 40% 45% 55% 60%; }
        .shape-ios { border-radius: 23%; }
        .slider-container {
            margin-top: 10px;
        }
        .slider-value {
            text-align: center;
            font-weight: bold;
            color: #FF6B00;
            margin-top: 5px;
        }
        .wallpaper-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }
        .wallpaper-option {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        .wallpaper-option:hover {
            border-color: #FF6B00;
            background: #fff8f3;
        }
        .wallpaper-option.active {
            border-color: #FF6B00;
            background: #fff8f3;
            box-shadow: 0 4px 12px rgba(255, 107, 0, 0.2);
        }
        .wallpaper-option-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        .wallpaper-option-text {
            font-size: 14px;
            font-weight: 500;
        }
        .preview-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }
        .phone-preview {
            background: #1a1a1a;
            border-radius: 30px;
            padding: 15px;
            max-width: 300px;
            margin: 0 auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .phone-screen {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            aspect-ratio: 9/19.5;
            position: relative;
        }
        .wallpaper-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
        }
        .overlay-layer {
            position: relative;
            z-index: 1;
            height: 100%;
        }
        .status-bar {
            height: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            font-size: 12px;
            font-weight: 500;
        }
        .app-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            padding: 20px;
        }
        .app-icon {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        .app-label {
            text-align: center;
            font-size: 10px;
            margin-top: 5px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }
        .button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #FF6B00 0%, #FF8E53 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 107, 0, 0.3);
        }
        .success-message {
            display: none;
            background: #4caf50;
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            text-align: center;
            animation: slideIn 0.3s;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 14px;
            line-height: 1.6;
        }
        .upload-area {
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .upload-area:hover {
            border-color: #FF6B00;
            background: #fff8f3;
        }
        .upload-area input[type="file"] {
            display: none;
        }
        .upload-label {
            color: #666;
            font-size: 14px;
        }
        .file-name {
            margin-top: 10px;
            font-size: 12px;
            color: #FF6B00;
            font-weight: 600;
        }
        .wallpaper-preview {
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden;
            max-height: 200px;
        }
        .wallpaper-preview img {
            width: 100%;
            height: auto;
            display: block;
        }
        .remove-wallpaper {
            margin-top: 10px;
            padding: 8px 16px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }
        .remove-wallpaper:hover {
            background: #d32f2f;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® Cr√©ateur de Th√®mes Xiaomi</h1>
            <p>HyperOS 3 - Couleurs, polices, ic√¥nes et fond d'√©cran personnalisables</p>
        </div>
        <div class="content">
            <!-- Informations du th√®me -->
            <div class="section">
                <div class="section-title">üìù Informations du th√®me</div>
                <div class="input-group">
                    <label>Nom du th√®me</label>
                    <input type="text" id="themeName" value="Mon Th√®me Personnalis√©">
                </div>
                <div class="input-group">
                    <label>Auteur</label>
                    <input type="text" id="themeAuthor" value="Cr√©ateur">
                </div>
            </div>

            <!-- Fond d'√©cran -->
            <div class="section">
                <div class="section-title">üñºÔ∏è Fond d'√©cran</div>
                <div class="wallpaper-options">
                    <div class="wallpaper-option active" onclick="selectWallpaperMode('gradient')">
                        <div class="wallpaper-option-icon">üåà</div>
                        <div class="wallpaper-option-text">D√©grad√© de couleurs</div>
                    </div>
                    <div class="wallpaper-option" onclick="selectWallpaperMode('image')">
                        <div class="wallpaper-option-icon">üñºÔ∏è</div>
                        <div class="wallpaper-option-text">Image personnalis√©e</div>
                    </div>
                </div>
                
                <div id="gradientOptions" style="margin-top: 20px;">
                    <div class="color-grid">
                        <div class="color-picker-group">
                            <label>Couleur d√©grad√© haut</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="gradientTop" value="#FF6B00">
                                <span class="color-code" id="gradientTopCode">#FF6B00</span>
                            </div>
                        </div>
                        <div class="color-picker-group">
                            <label>Couleur d√©grad√© bas</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="gradientBottom" value="#FF8E53">
                                <span class="color-code" id="gradientBottomCode">#FF8E53</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="imageOptions" style="display: none; margin-top: 20px;">
                    <div class="upload-area" onclick="document.getElementById('wallpaperImage').click()">
                        <input type="file" id="wallpaperImage" accept="image/*">
                        <div class="upload-label">
                            üñºÔ∏è Cliquez pour importer un fond d'√©cran<br>
                            <small>(Format JPG, PNG - Recommand√©: 1080x2400px)</small>
                        </div>
                        <div class="file-name" id="wallpaperFileName"></div>
                    </div>
                    <div id="wallpaperPreviewContainer" style="display: none;">
                        <div class="wallpaper-preview">
                            <img id="wallpaperPreviewImg" src="" alt="Aper√ßu">
                        </div>
                        <button class="remove-wallpaper" onclick="removeWallpaper()">üóëÔ∏è Supprimer l'image</button>
                    </div>
                </div>
            </div>
            
            <!-- Palette de couleurs -->
            <div class="section">
                <div class="section-title">üé® Palette de couleurs</div>
                <div class="color-grid">
                    <div class="color-picker-group">
                        <label>Couleur principale</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="primaryColor" value="#FF6B00">
                            <span class="color-code" id="primaryColorCode">#FF6B00</span>
                        </div>
                    </div>
                    <div class="color-picker-group">
                        <label>Couleur secondaire</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="secondaryColor" value="#FF8E53">
                            <span class="color-code" id="secondaryColorCode">#FF8E53</span>
                        </div>
                    </div>
                    <div class="color-picker-group">
                        <label>Couleur d'accent</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="accentColor" value="#FFA726">
                            <span class="color-code" id="accentColorCode">#FFA726</span>
                        </div>
                    </div>
                    <div class="color-picker-group">
                        <label>Couleur de fond ic√¥nes</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="backgroundColor" value="#FFFFFF">
                            <span class="color-code" id="backgroundColorCode">#FFFFFF</span>
                        </div>
                    </div>
                    <div class="color-picker-group">
                        <label>Couleur du texte</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="textColor" value="#FFFFFF">
                            <span class="color-code" id="textColorCode">#FFFFFF</span>
                        </div>
                    </div>
                    <div class="color-picker-group">
                        <label>Barre de statut</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="statusBarColor" value="#000000">
                            <span class="color-code" id="statusBarColorCode">#000000</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Polices de caract√®res -->
            <div class="section">
                <div class="section-title">‚úçÔ∏è Polices de caract√®res</div>
                <div class="font-grid">
                    <div class="font-picker-group">
                        <label>Police syst√®me</label>
                        <select id="systemFont">
                            <option value="Roboto">Roboto (par d√©faut)</option>
                            <option value="Open Sans">Open Sans</option>
                            <option value="Lato">Lato</option>
                            <option value="Montserrat">Montserrat</option>
                            <option value="Poppins">Poppins</option>
                            <option value="Playfair Display">Playfair Display</option>
                            <option value="Dancing Script">Dancing Script</option>
                            <option value="Pacifico">Pacifico</option>
                        </select>
                        <div class="font-preview">
                            <div class="font-preview-text" id="systemFontPreview" style="font-family: Roboto;">
                                Exemple de texte
                            </div>
                            <div class="font-preview-small" id="systemFontPreviewSmall" style="font-family: Roboto;">
                                AaBbCc 123
                            </div>
                        </div>
                    </div>
                    <div class="font-picker-group">
                        <label>Police des titres</label>
                        <select id="titleFont">
                            <option value="Roboto">Roboto (par d√©faut)</option>
                            <option value="Open Sans">Open Sans</option>
                            <option value="Lato">Lato</option>
                            <option value="Montserrat" selected>Montserrat</option>
                            <option value="Poppins">Poppins</option>
                            <option value="Playfair Display">Playfair Display</option>
                            <option value="Dancing Script">Dancing Script</option>
                            <option value="Pacifico">Pacifico</option>
                        </select>
                        <div class="font-preview">
                            <div class="font-preview-text" id="titleFontPreview" style="font-family: Montserrat; font-weight: bold;">
                                Titre Principal
                            </div>
                            <div class="font-preview-small" id="titleFontPreviewSmall" style="font-family: Montserrat;">
                                AaBbCc 123
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="input-group" style="margin-top: 20px;">
                    <label>üìÅ Importer une police personnalis√©e (.ttf)</label>
                    <div class="upload-area" onclick="document.getElementById('customFont').click()">
                        <input type="file" id="customFont" accept=".ttf,.otf">
                        <div class="upload-label">
                            üì§ Cliquez pour importer un fichier de police<br>
                            <small>(Format .ttf ou .otf)</small>
                        </div>
                        <div class="file-name" id="customFontName"></div>
                    </div>
                </div>
            </div>

            <!-- Forme des ic√¥nes -->
            <div class="section">
                <div class="section-title">üî∑ Forme des ic√¥nes</div>
                <div class="icon-shape-group">
                    <label>Choisissez une forme</label>
                    <div class="icon-shapes">
                        <div class="icon-shape-option shape-square" onclick="selectShape('square', 0)" data-shape="square">
                            <span>‚¨ú</span>
                        </div>
                        <div class="icon-shape-option shape-rounded active" onclick="selectShape('rounded', 20)" data-shape="rounded">
                            <span>‚ñ¢</span>
                        </div>
                        <div class="icon-shape-option shape-superround" onclick="selectShape('superround', 35)" data-shape="superround">
                            <span>üî≤</span>
                        </div>
                        <div class="icon-shape-option shape-circle" onclick="selectShape('circle', 50)" data-shape="circle">
                            <span>‚óè</span>
                        </div>
                        <div class="icon-shape-option shape-squircle" onclick="selectShape('squircle', 25)" data-shape="squircle">
                            <span>‚óâ</span>
                        </div>
                        <div class="icon-shape-option shape-ios" onclick="selectShape('ios', 23)" data-shape="ios">
                            <span>üì±</span>
                        </div>
                        <div class="icon-shape-option shape-teardrop" onclick="selectShape('teardrop', 'custom')" data-shape="teardrop">
                            <span>üíß</span>
                        </div>
                        <div class="icon-shape-option shape-pebble" onclick="selectShape('pebble', 'custom')" data-shape="pebble">
                            <span>ü™®</span>
                        </div>
                    </div>
                </div>
                
                <div class="icon-shape-group" style="margin-top: 20px;">
                    <label>Arrondissement personnalis√©</label>
                    <div class="slider-container">
                        <input type="range" id="iconRadius" min="0" max="50" value="20" oninput="updateIconRadius()">
                        <div class="slider-value" id="radiusValue">20%</div>
                    </div>
                </div>

                <div class="icon-shape-group" style="margin-top: 20px;">
                    <label>Taille des ic√¥nes</label>
                    <div class="slider-container">
                        <input type="range" id="iconSize" min="80" max="120" value="100" oninput="updateIconSize()">
                        <div class="slider-value" id="sizeValue">100%</div>
                    </div>
                </div>
            </div>

            <!-- Aper√ßu du th√®me -->
            <div class="section">
                <div class="section-title">üì± Aper√ßu du th√®me</div>
                <div class="preview-section">
                    <div class="phone-preview">
                        <div class="phone-screen" id="phoneScreen">
                            <img id="wallpaperLayer" class="wallpaper-layer" style="display: none;">
                            <div class="overlay-layer">
                                <div class="status-bar" id="statusBar">
                                    <span>9:41</span>
                                    <span>üì∂ üîã</span>
                                </div>
                                <div class="app-grid" id="appGrid">
                                    <div>
                                        <div class="app-icon" id="icon1">üì±</div>
                                        <div class="app-label" id="label1">T√©l√©phone</div>
                                    </div>
                                    <div>
                                        <div class="app-icon" id="icon2">üí¨</div>
                                        <div class="app-label" id="label2">Messages</div>
                                    </div>
                                    <div>
                                        <div class="app-icon" id="icon3">üì∑</div>
                                        <div class="app-label" id="label3">Appareil photo</div>
                                    </div>
                                    <div>
                                        <div class="app-icon" id="icon4">‚öôÔ∏è</div>
                                        <div class="app-label" id="label4">Param√®tres</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button class="button" onclick="generateTheme()">
                üöÄ G√©n√©rer le fichier .mtz
            </button>
            
            <div class="success-message" id="successMessage">
                ‚úÖ Th√®me g√©n√©r√© avec succ√®s ! Le t√©l√©chargement va commencer...
            </div>
            
            <div class="info-box">
                <strong>üìñ Comment utiliser :</strong><br>
                1. Personnalisez les couleurs, polices, formes et fond d'√©cran<br>
                2. Cliquez sur "G√©n√©rer le fichier .mtz"<br>
                3. Transf√©rez le fichier sur votre Xiaomi<br>
                4. Ouvrez l'application Th√®mes et importez le fichier<br>
                5. Appliquez votre nouveau th√®me !
            </div>
        </div>
    </div>
    
    <script>
        // Variables globales
        let currentIconShape = 'rounded';
        let currentIconRadius = 20;
        let currentIconSize = 100;
        let customFontFile = null;
        let wallpaperMode = 'gradient';
        let wallpaperImageFile = null;
        let wallpaperImageData = null;

        // Configuration des √©couteurs d'√©v√©nements pour les couleurs
        const colorInputs = [
            { input: 'primaryColor', display: 'primaryColorCode' },
            { input: 'secondaryColor', display: 'secondaryColorCode' },
            { input: 'accentColor', display: 'accentColorCode' },
            { input: 'backgroundColor', display: 'backgroundColorCode' },
            { input: 'textColor', display: 'textColorCode' },
            { input: 'statusBarColor', display: 'statusBarColorCode' },
            { input: 'gradientTop', display: 'gradientTopCode' },
            { input: 'gradientBottom', display: 'gradientBottomCode' }
        ];

        colorInputs.forEach(({input, display}) => {
            const inputElement = document.getElementById(input);
            const displayElement = document.getElementById(display);
            
            if (inputElement && displayElement) {
                inputElement.addEventListener('input', function() {
                    displayElement.textContent = this.value.toUpperCase();
                    updatePreview();
                });
            }
        });

        // √âcouteurs pour les polices
        document.getElementById('systemFont').addEventListener('change', function() {
            const font = this.value;
            document.getElementById('systemFontPreview').style.fontFamily = font;
            document.getElementById('systemFontPreviewSmall').style.fontFamily = font;
            updatePreview();
        });

        document.getElementById('titleFont').addEventListener('change', function() {
            const font = this.value;
            document.getElementById('titleFontPreview').style.fontFamily = font;
            document.getElementById('titleFontPreviewSmall').style.fontFamily = font;
            updatePreview();
        });

        // Gestion du fichier de police personnalis√©e
        document.getElementById('customFont').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                customFontFile = file;
                document.getElementById('customFontName').textContent = '‚úì ' + file.name;
            }
        });

        // Gestion de l'image de fond d'√©cran
        document.getElementById('wallpaperImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                wallpaperImageFile = file;
                document.getElementById('wallpaperFileName').textContent = '‚úì ' + file.name;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    wallpaperImageData = event.target.result;
                    document.getElementById('wallpaperPreviewImg').src = wallpaperImageData;
                    document.getElementById('wallpaperPreviewContainer').style.display = 'block';
                    updatePreview();
                };
                reader.readAsDataURL(file);
            }
        });

        // Fonction pour s√©lectionner le mode de fond d'√©cran
        function selectWallpaperMode(mode) {
            wallpaperMode = mode;
            
            // Mettre √† jour l'interface
            document.querySelectorAll('.wallpaper-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.closest('.wallpaper-option').classList.add('active');
            
            // Afficher/masquer les options
            if (mode === 'gradient') {
                document.getElementById('gradientOptions').style.display = 'block';
                document.getElementById('imageOptions').style.display = 'none';
            } else {
                document.getElementById('gradientOptions').style.display = 'none';
                document.getElementById('imageOptions').style.display = 'block';
            }
            
            updatePreview();
        }

        // Fonction pour supprimer le fond d'√©cran
        function removeWallpaper() {
            wallpaperImageFile = null;
            wallpaperImageData = null;
            document.getElementById('wallpaperImage').value = '';
            document.getElementById('wallpaperFileName').textContent = '';
            document.getElementById('wallpaperPreviewContainer').style.display = 'none';
            updatePreview();
        }

        // Fonction pour s√©lectionner une forme d'ic√¥ne
        function selectShape(shapeName, radius) {
            currentIconShape = shapeName;
            
            document.querySelectorAll('.icon-shape-option').forEach(option => {
                option.classList.remove('active');
            });
            
            event.target.closest('.icon-shape-option').classList.add('active');
            
            if (typeof radius === 'number') {
                currentIconRadius = radius;
                document.getElementById('iconRadius').value = radius;
                document.getElementById('radiusValue').textContent = radius + '%';
            }
            
            updatePreview();
        }

        // Fonction pour mettre √† jour l'arrondissement des ic√¥nes
        function updateIconRadius() {
            currentIconRadius = document.getElementById('iconRadius').value;
            document.getElementById('radiusValue').textContent = currentIconRadius + '%';
            updatePreview();
        }

        // Fonction pour mettre √† jour la taille des ic√¥nes
        function updateIconSize() {
            currentIconSize = document.getElementById('iconSize').value;
            document.getElementById('sizeValue').textContent = currentIconSize + '%';
            updatePreview();
        }

        // Fonction pour obtenir le style border-radius selon la forme
        function getIconBorderRadius(shapeName) {
            const shapes = {
                'square': '0%',
                'rounded': '20%',
                'superround': '35%',
                'circle': '50%',
                'squircle': '25%',
                'ios': '23%',
                'teardrop': '25% 25% 25% 60%',
                'pebble': '35% 65% 70% 30% / 40% 45% 55% 60%'
            };
            return shapes[shapeName] || currentIconRadius + '%';
        }

        // Fonction pour mettre √† jour l'aper√ßu en temps r√©el
        function updatePreview() {
            const primaryColor = document.getElementById('primaryColor').value;
            const secondaryColor = document.getElementById('secondaryColor').value;
            const accentColor = document.getElementById('accentColor').value;
            const backgroundColor = document.getElementById('backgroundColor').value;
            const textColor = document.getElementById('textColor').value;
            const statusBarColor = document.getElementById('statusBarColor').value;
            const systemFont = document.getElementById('systemFont').value;
            const phoneScreen = document.getElementById('phoneScreen');
            const wallpaperLayer = document.getElementById('wallpaperLayer');

            // Mise √† jour du fond d'√©cran
            if (wallpaperMode === 'image' && wallpaperImageData) {
                wallpaperLayer.src = wallpaperImageData;
                wallpaperLayer.style.display = 'block';
                phoneScreen.style.background = 'transparent';
            } else {
                wallpaperLayer.style.display = 'none';
                const gradientTop = document.getElementById('gradientTop').value;
                const gradientBottom = document.getElementById('gradientBottom').value;
                phoneScreen.style.background = `linear-gradient(180deg, ${gradientTop} 0%, ${gradientBottom} 100%)`;
            }

            // Mise √† jour de la barre de statut
            const statusBar = document.getElementById('statusBar');
            statusBar.style.background = statusBarColor;
            statusBar.style.color = getContrastColor(statusBarColor);

            // Mise √† jour des ic√¥nes avec la forme et la taille
            const icons = ['icon1', 'icon2', 'icon3', 'icon4'];
            const labels = ['label1', 'label2', 'label3', 'label4'];
            const colors = [primaryColor, secondaryColor, accentColor, backgroundColor];
            
            const borderRadius = getIconBorderRadius(currentIconShape);
            const scale = currentIconSize / 100;
            
            icons.forEach((iconId, index) => {
                const icon = document.getElementById(iconId);
                icon.style.background = colors[index];
                icon.style.color = getContrastColor(colors[index]);
                icon.style.borderRadius = borderRadius;
                icon.style.transform = `scale(${scale})`;
            });

            // Mise √† jour des labels avec la police syst√®me
            labels.forEach(labelId => {
                const label = document.getElementById(labelId);
                label.style.color = textColor;
                label.style.fontFamily = systemFont;
            });
        }

        // Fonction pour calculer une couleur contrastante (texte lisible)
        function getContrastColor(hexColor) {
            const hex = hexColor.replace('#', '');
            const r = parseInt(hex.substring(0, 2), 16);
            const g = parseInt(hex.substring(2, 4), 16);
            const b = parseInt(hex.substring(4, 6), 16);
            const brightness = (r * 299 + g * 587 + b * 114) / 1000;
            return brightness > 128 ? '#000000' : '#FFFFFF';
        }

        // Fonction pour g√©n√©rer le fichier description.xml
        function generateDescriptionXML() {
            const themeName = document.getElementById('themeName').value || 'Mon Th√®me';
            const author = document.getElementById('themeAuthor').value || 'Cr√©ateur';
            const primaryColor = document.getElementById('primaryColor').value;
            const secondaryColor = document.getElementById('secondaryColor').value;
            const accentColor = document.getElementById('accentColor').value;
            const backgroundColor = document.getElementById('backgroundColor').value;
            const textColor = document.getElementById('textColor').value;
            const statusBarColor = document.getElementById('statusBarColor').value;
            const systemFont = document.getElementById('systemFont').value;
            const titleFont = document.getElementById('titleFont').value;

            return `<?xml version="1.0" encoding="UTF-8"?>
<MIUI-Theme>
    <version>3</version>
    <uiVersion>14</uiVersion>
    <title>${themeName}</title>
    <author>${author}</author>
    <designer>${author}</designer>
    <description>Th√®me personnalis√© cr√©√© avec Xiaomi Theme Creator</description>
    
    <colors>
        <color name="primary_color">${primaryColor}</color>
        <color name="secondary_color">${secondaryColor}</color>
        <color name="accent_color">${accentColor}</color>
        <color name="background_color">${backgroundColor}</color>
        <color name="text_color">${textColor}</color>
        <color name="status_bar_color">${statusBarColor}</color>
    </colors>
    
    <fonts>
        <font name="system_font">${systemFont}</font>
        <font name="title_font">${titleFont}</font>
    </fonts>
    
    <icons>
        <shape>${currentIconShape}</shape>
        <border_radius>${currentIconRadius}</border_radius>
        <size_scale>${currentIconSize}</size_scale>
    </icons>
    
    <wallpaper>
        <mode>${wallpaperMode}</mode>
        <has_custom_image>${wallpaperImageFile ? 'true' : 'false'}</has_custom_image>
    </wallpaper>
    
    <theme_values>
        <resourceType name="color">
            <item name="control_activated_color">${primaryColor}</item>
            <item name="control_normal_color">${secondaryColor}</item>
            <item name="highlight_color">${accentColor}</item>
            <item name="window_background_color">${backgroundColor}</item>
            <item name="primary_text_color">${textColor}</item>
        </resourceType>
    </theme_values>
</MIUI-Theme>`;
        }

        // Fonction pour g√©n√©rer le fichier .mtz
        async function generateTheme() {
            const themeName = document.getElementById('themeName').value || 'MonTheme';
            const zip = new JSZip();

            // Ajouter le fichier description.xml
            zip.file('description.xml', generateDescriptionXML());

            // Ajouter l'image de fond d'√©cran si elle existe
            if (wallpaperImageFile) {
                const imageData = await wallpaperImageFile.arrayBuffer();
                zip.file('wallpaper/' + wallpaperImageFile.name, imageData);
            }

            // Ajouter la police personnalis√©e si import√©e
            if (customFontFile) {
                const fontData = await customFontFile.arrayBuffer();
                zip.file('fonts/' + customFontFile.name, fontData);
            }

            // Ajouter un fichier README
            const readme = `Th√®me Xiaomi HyperOS 3
========================

Nom: ${themeName}
Auteur: ${document.getElementById('themeAuthor').value}
Date: ${new Date().toLocaleDateString('fr-FR')}

Personnalisations:
- Couleurs: ${document.getElementById('primaryColor').value}
- Police syst√®me: ${document.getElementById('systemFont').value}
- Forme des ic√¥nes: ${currentIconShape}
- Taille des ic√¥nes: ${currentIconSize}%
- Fond d'√©cran: ${wallpaperMode === 'image' && wallpaperImageFile ? 'Image personnalis√©e' : 'D√©grad√© de couleurs'}

Installation:
1. Transf√©rez ce fichier .mtz sur votre Xiaomi
2. Ouvrez l'application "Th√®mes"
3. Appuyez sur "Profil" en bas √† droite
4. S√©lectionnez "Th√®mes import√©s"
5. Appliquez votre th√®me

Cr√©√© avec Xiaomi Theme Creator
Compatible avec HyperOS 3 et versions ult√©rieures
`;
            zip.file('README.txt', readme);

            try {
                // G√©n√©rer le fichier ZIP
                const blob = await zip.generateAsync({ type: 'blob' });
                
                // Cr√©er un lien de t√©l√©chargement
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `${themeName.replace(/\s+/g, '_')}.mtz`;
                link.click();

                // Afficher le message de succ√®s
                const successMessage = document.getElementById('successMessage');
                successMessage.style.display = 'block';
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 5000);
            } catch (error) {
                alert('Erreur lors de la g√©n√©ration du th√®me: ' + error.message);
            }
        }

        // Initialiser l'aper√ßu au chargement de la page
        window.addEventListener('DOMContentLoaded', function() {
            updatePreview();
        });
    </script>
</body>
</html>
